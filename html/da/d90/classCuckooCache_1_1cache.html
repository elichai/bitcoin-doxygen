<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bitcoin: CuckooCache::cache&lt; Element, Hash &gt; Class Template Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d1/d1a/namespaceCuckooCache.html">CuckooCache</a></li><li class="navelem"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">cache</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../d1/d78/classCuckooCache_1_1cache-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">CuckooCache::cache&lt; Element, Hash &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../de/d9b/cuckoocache_8h_source.html">cuckoocache.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adcc64063187792eb7a1e21dd272f878a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#adcc64063187792eb7a1e21dd272f878a">cache</a> ()</td></tr>
<tr class="separator:adcc64063187792eb7a1e21dd272f878a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49c60604e9dc27cbede5e54d56761778"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a49c60604e9dc27cbede5e54d56761778">setup</a> (<a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> new_size)</td></tr>
<tr class="separator:a49c60604e9dc27cbede5e54d56761778"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a835c482796c27ae4f3fd5d01173678a3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a835c482796c27ae4f3fd5d01173678a3">setup_bytes</a> (size_t bytes)</td></tr>
<tr class="separator:a835c482796c27ae4f3fd5d01173678a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7196070c52ba258b62a2c0d0bc7471d2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a7196070c52ba258b62a2c0d0bc7471d2">insert</a> (Element e)</td></tr>
<tr class="separator:a7196070c52ba258b62a2c0d0bc7471d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accd11546d716cdad34267a042d3b261e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#accd11546d716cdad34267a042d3b261e">contains</a> (const Element &amp;e, const bool erase) const</td></tr>
<tr class="separator:accd11546d716cdad34267a042d3b261e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a79cd81d127e3952643c5dd3b28145ce0"><td class="memItemLeft" align="right" valign="top">std::array&lt; <a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>, 8 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a79cd81d127e3952643c5dd3b28145ce0">compute_hashes</a> (const Element &amp;e) const</td></tr>
<tr class="separator:a79cd81d127e3952643c5dd3b28145ce0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa97007198c668e1f03b37708d83a6b8a"><td class="memItemLeft" align="right" valign="top">constexpr <a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#aa97007198c668e1f03b37708d83a6b8a">invalid</a> () const</td></tr>
<tr class="separator:aa97007198c668e1f03b37708d83a6b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac99877952b8f09e64d203ff54c95ad2f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#ac99877952b8f09e64d203ff54c95ad2f">allow_erase</a> (<a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> n) const</td></tr>
<tr class="separator:ac99877952b8f09e64d203ff54c95ad2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad655128aa36ae6dac7e931e42705b3d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#ad655128aa36ae6dac7e931e42705b3d9">please_keep</a> (<a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> n) const</td></tr>
<tr class="separator:ad655128aa36ae6dac7e931e42705b3d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ca088a2a92cbd3a75b7514daf054e9d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a5ca088a2a92cbd3a75b7514daf054e9d">epoch_check</a> ()</td></tr>
<tr class="separator:a5ca088a2a92cbd3a75b7514daf054e9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a28708bc3035f05ad8a16535cf4bd714d"><td class="memItemLeft" align="right" valign="top">std::vector&lt; Element &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a28708bc3035f05ad8a16535cf4bd714d">table</a></td></tr>
<tr class="separator:a28708bc3035f05ad8a16535cf4bd714d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a044e6c760169e2a171e0f2e955f31ca8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a044e6c760169e2a171e0f2e955f31ca8">size</a></td></tr>
<tr class="separator:a044e6c760169e2a171e0f2e955f31ca8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73f56a65c98279dab65269f62e5506a3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/d59/classCuckooCache_1_1bit__packed__atomic__flags.html">bit_packed_atomic_flags</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a73f56a65c98279dab65269f62e5506a3">collection_flags</a></td></tr>
<tr class="separator:a73f56a65c98279dab65269f62e5506a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e81a89c32f6f5c1093ddd30a99734a9"><td class="memItemLeft" align="right" valign="top">std::vector&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a6e81a89c32f6f5c1093ddd30a99734a9">epoch_flags</a></td></tr>
<tr class="separator:a6e81a89c32f6f5c1093ddd30a99734a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bef78baf7f3c950b7b31394dd562e8a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a2bef78baf7f3c950b7b31394dd562e8a">epoch_heuristic_counter</a></td></tr>
<tr class="separator:a2bef78baf7f3c950b7b31394dd562e8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c66f444f485ed95ba23c5908939fde6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a6c66f444f485ed95ba23c5908939fde6">epoch_size</a></td></tr>
<tr class="separator:a6c66f444f485ed95ba23c5908939fde6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22923824d2f457d0b3ef99a85a7fa293"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a22923824d2f457d0b3ef99a85a7fa293">depth_limit</a></td></tr>
<tr class="separator:a22923824d2f457d0b3ef99a85a7fa293"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaab62805eb484663dff743ae0a6dfae9"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#aaab62805eb484663dff743ae0a6dfae9">hash_function</a></td></tr>
<tr class="separator:aaab62805eb484663dff743ae0a6dfae9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename Element, typename Hash&gt;<br />
class CuckooCache::cache&lt; Element, Hash &gt;</h3>

<p>cache implements a cache with properties similar to a cuckoo-set</p>
<p>The cache is able to hold up to (~(uint32_t)0) - 1 elements.</p>
<p>Read Operations:</p><ul>
<li>contains(*, false)</li>
</ul>
<p>Read+Erase Operations:</p><ul>
<li>contains(*, true)</li>
</ul>
<p>Erase Operations:</p><ul>
<li><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#ac99877952b8f09e64d203ff54c95ad2f">allow_erase()</a></li>
</ul>
<p>Write Operations:</p><ul>
<li><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a49c60604e9dc27cbede5e54d56761778">setup()</a></li>
<li><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a835c482796c27ae4f3fd5d01173678a3">setup_bytes()</a></li>
<li><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a7196070c52ba258b62a2c0d0bc7471d2">insert()</a></li>
<li><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#ad655128aa36ae6dac7e931e42705b3d9">please_keep()</a></li>
</ul>
<p>Synchronization Free Operations:</p><ul>
<li><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#aa97007198c668e1f03b37708d83a6b8a">invalid()</a></li>
<li><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a79cd81d127e3952643c5dd3b28145ce0">compute_hashes()</a></li>
</ul>
<p>User Must Guarantee:</p>
<p>1) Write Requires synchronized access (e.g., a lock) 2) Read Requires no concurrent Write, synchronized with the last insert. 3) Erase requires no concurrent Write, synchronized with last insert. 4) An Erase caller must release all memory before allowing a new Writer.</p>
<p>Note on function names:</p><ul>
<li>The name "allow_erase" is used because the real discard happens later.</li>
<li>The name "please_keep" is used because elements may be erased anyways on insert.</li>
</ul>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Element</td><td>should be a movable and copyable type </td></tr>
    <tr><td class="paramname">Hash</td><td>should be a function/callable which takes a template parameter hash_select and an Element and extracts a hash from it. Should return high-entropy uint32_t hashes for <code>Hash h; h&lt;0&gt;(e) ... h&lt;7&gt;(e)</code>. </td></tr>
  </table>
  </dd>
</dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="adcc64063187792eb7a1e21dd272f878a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcc64063187792eb7a1e21dd272f878a">&#9670;&nbsp;</a></span>cache()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::<a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">cache</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>You must always construct a cache with some elements via a subsequent call to setup or setup_bytes, otherwise operations may segfault. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ac99877952b8f09e64d203ff54c95ad2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac99877952b8f09e64d203ff54c95ad2f">&#9670;&nbsp;</a></span>allow_erase()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::allow_erase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>allow_erase marks the element at index n as discardable. Threadsafe without any concurrent insert. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">n</td><td>the index to allow erasure of </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a79cd81d127e3952643c5dd3b28145ce0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79cd81d127e3952643c5dd3b28145ce0">&#9670;&nbsp;</a></span>compute_hashes()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::array&lt;<a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>, 8&gt; <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::compute_hashes </td>
          <td>(</td>
          <td class="paramtype">const Element &amp;&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>compute_hashes is convenience for not having to write out this expression everywhere we use the hash values of an Element.</p>
<p>We need to map the 32-bit input hash onto a hash bucket in a range [0, size) in a manner which preserves as much of the hash's uniformity as possible. Ideally this would be done by bitmasking but the size is usually not a power of two.</p>
<p>The naive approach would be to use a mod &ndash; which isn't perfectly uniform but so long as the hash is much larger than size it is not that bad. Unfortunately, mod/division is fairly slow on ordinary microprocessors (e.g. 90-ish cycles on haswell, ARM doesn't even have an instruction for it.); when the divisor is a constant the compiler will do clever tricks to turn it into a multiply+add+shift, but size is a run-time value so the compiler can't do that here.</p>
<p>One option would be to implement the same trick the compiler uses and compute the constants for exact division based on the size, as described in "{N}-bit Unsigned
 Division via {N}-bit Multiply-Add" by Arch D. Robison in 2005. But that code is somewhat complicated and the result is still slower than other options:</p>
<p>Instead we treat the 32-bit random number as a Q32 fixed-point number in the range [0,1) and simply multiply it by the size. Then we just shift the result down by 32-bits to get our bucket number. The result has non-uniformity the same as a mod, but it is much faster to compute. More about this technique can be found at <a href="http://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/">http://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/</a></p>
<p>The resulting non-uniformity is also more equally distributed which would be advantageous for something like linear probing, though it shouldn't matter one way or the other for a cuckoo table.</p>
<p>The primary disadvantage of this approach is increased intermediate precision is required but for a 32-bit random number we only need the high 32 bits of a 32*32-&gt;64 multiply, which means the operation is reasonably fast even on a typical 32-bit processor.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>the element whose hashes will be returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>std::array&lt;uint32_t, 8&gt; of deterministic hashes derived from e </dd></dl>

</div>
</div>
<a id="accd11546d716cdad34267a042d3b261e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accd11546d716cdad34267a042d3b261e">&#9670;&nbsp;</a></span>contains()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::contains </td>
          <td>(</td>
          <td class="paramtype">const Element &amp;&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>erase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5ca088a2a92cbd3a75b7514daf054e9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ca088a2a92cbd3a75b7514daf054e9d">&#9670;&nbsp;</a></span>epoch_check()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::epoch_check </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>epoch_check handles the changing of epochs for elements stored in the cache. epoch_check should be run before every insert.</p>
<p>First, epoch_check decrements and checks the cheap heuristic, and then does a more expensive scan if the cheap heuristic runs out. If the expensive scan succeeds, the epochs are aged and old elements are allow_erased. The cheap heuristic is reset to retrigger after the worst case growth of the current epoch's elements would exceed the epoch_size. </p>

</div>
</div>
<a id="a7196070c52ba258b62a2c0d0bc7471d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7196070c52ba258b62a2c0d0bc7471d2">&#9670;&nbsp;</a></span>insert()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::insert </td>
          <td>(</td>
          <td class="paramtype">Element&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>insert loops at most depth_limit times trying to insert a hash at various locations in the table via a variant of the Cuckoo Algorithm with eight hash locations.</p>
<p>It drops the last tried element if it runs out of depth before encountering an open slot.</p>
<p>Thus</p>
<p>insert(x); return contains(x, false);</p>
<p>is not guaranteed to return true.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>the element to insert </td></tr>
  </table>
  </dd>
</dl>
<dl class="section post"><dt>Postcondition</dt><dd>one of the following: All previously inserted elements and e are now in the table, one previously inserted element is evicted from the table, the entry attempted to be inserted is evicted. </dd></dl>
<p>Swap with the element at the location that was not the last one looked at. Example:</p>
<p>1) On first iteration, last_loc == <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#aa97007198c668e1f03b37708d83a6b8a">invalid()</a>, find returns last, so last_loc defaults to locs[0]. 2) On further iterations, where last_loc == locs[k], last_loc will go to locs[k+1 % 8], i.e., next of the 8 indices wrapping around to 0 if needed.</p>
<p>This prevents moving the element we just put in.</p>
<p>The swap is not a move &ndash; we must switch onto the evicted element for the next iteration.</p>

</div>
</div>
<a id="aa97007198c668e1f03b37708d83a6b8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa97007198c668e1f03b37708d83a6b8a">&#9670;&nbsp;</a></span>invalid()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr <a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::invalid </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ad655128aa36ae6dac7e931e42705b3d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad655128aa36ae6dac7e931e42705b3d9">&#9670;&nbsp;</a></span>please_keep()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::please_keep </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>please_keep marks the element at index n as an entry that should be kept. Threadsafe without any concurrent insert. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">n</td><td>the index to prioritize keeping </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a49c60604e9dc27cbede5e54d56761778"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49c60604e9dc27cbede5e54d56761778">&#9670;&nbsp;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::setup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>new_size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>setup initializes the container to store no more than new_size elements.</p>
<p>setup should only be called once.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_size</td><td>the desired number of elements to store </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the maximum number of elements storable </dd></dl>

</div>
</div>
<a id="a835c482796c27ae4f3fd5d01173678a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a835c482796c27ae4f3fd5d01173678a3">&#9670;&nbsp;</a></span>setup_bytes()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::setup_bytes </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bytes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>setup_bytes is a convenience function which accounts for internal memory usage when deciding how many elements to store. It isn't perfect because it doesn't account for any overhead (struct size, MallocUsage, collection and epoch flags). This was done to simplify selecting a power of two size. In the expected use case, an extra two bits per entry should be negligible compared to the size of the elements.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bytes</td><td>the approximate number of bytes to use for this data structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the maximum number of elements storable (see <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a49c60604e9dc27cbede5e54d56761778">setup()</a> documentation for more detail) </dd></dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a73f56a65c98279dab65269f62e5506a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73f56a65c98279dab65269f62e5506a3">&#9670;&nbsp;</a></span>collection_flags</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d59/classCuckooCache_1_1bit__packed__atomic__flags.html">bit_packed_atomic_flags</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::collection_flags</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The <a class="el" href="../../df/d59/classCuckooCache_1_1bit__packed__atomic__flags.html">bit_packed_atomic_flags</a> array is marked mutable because we want garbage collection to be allowed to occur from const methods </p>

</div>
</div>
<a id="a22923824d2f457d0b3ef99a85a7fa293"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22923824d2f457d0b3ef99a85a7fa293">&#9670;&nbsp;</a></span>depth_limit</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/dd8/stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::depth_limit</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>depth_limit determines how many elements insert should try to replace. Should be set to log2(n) </p>

</div>
</div>
<a id="a6e81a89c32f6f5c1093ddd30a99734a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e81a89c32f6f5c1093ddd30a99734a9">&#9670;&nbsp;</a></span>epoch_flags</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;bool&gt; <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::epoch_flags</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>epoch_flags tracks how recently an element was inserted into the cache. true denotes recent, false denotes not-recent. See <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html#a7196070c52ba258b62a2c0d0bc7471d2">insert()</a> method for full semantics. </p>

</div>
</div>
<a id="a2bef78baf7f3c950b7b31394dd562e8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bef78baf7f3c950b7b31394dd562e8a">&#9670;&nbsp;</a></span>epoch_heuristic_counter</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::epoch_heuristic_counter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>epoch_heuristic_counter is used to determine when an epoch might be aged &amp; an expensive scan should be done. epoch_heuristic_counter is decremented on insert and reset to the new number of inserts which would cause the epoch to reach epoch_size when it reaches zero. </p>

</div>
</div>
<a id="a6c66f444f485ed95ba23c5908939fde6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c66f444f485ed95ba23c5908939fde6">&#9670;&nbsp;</a></span>epoch_size</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::epoch_size</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>epoch_size is set to be the number of elements supposed to be in a epoch. When the number of non-erased elements in an epoch exceeds epoch_size, a new epoch should be started and all current entries demoted. epoch_size is set to be 45% of size because we want to keep load around 90%, and we support 3 epochs at once &ndash; one "dead" which has been erased, one "dying" which has been marked to be erased next, and one "living" which new inserts add to. </p>

</div>
</div>
<a id="aaab62805eb484663dff743ae0a6dfae9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaab62805eb484663dff743ae0a6dfae9">&#9670;&nbsp;</a></span>hash_function</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::hash_function</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>hash_function is a const instance of the hash function. It cannot be static or initialized at call time as it may have internal state (such as a nonce). </p>

</div>
</div>
<a id="a044e6c760169e2a171e0f2e955f31ca8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a044e6c760169e2a171e0f2e955f31ca8">&#9670;&nbsp;</a></span>size</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/dd8/stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::size</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>size stores the total available slots in the hash table </p>

</div>
</div>
<a id="a28708bc3035f05ad8a16535cf4bd714d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28708bc3035f05ad8a16535cf4bd714d">&#9670;&nbsp;</a></span>table</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element, typename Hash&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;Element&gt; <a class="el" href="../../da/d90/classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, <a class="el" href="../../db/dfb/hash_8h.html#aea8943bbdf28dfc2030d00b330f4cdd6">Hash</a> &gt;::table</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>table stores all the elements </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/<a class="el" href="../../de/d9b/cuckoocache_8h_source.html">cuckoocache.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
