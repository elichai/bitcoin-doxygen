<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bitcoin: Support for Output Descriptors in Bitcoin Core</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Support for Output Descriptors in Bitcoin Core </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Since Bitcoin Core v0.17, there is support for Output Descriptors. This is a simple language which can be used to describe collections of output scripts. Supporting RPCs are:</p><ul>
<li><code>scantxoutset</code> takes as input descriptors to scan for, and also reports specialized descriptors for the matching UTXOs.</li>
<li><code>getdescriptorinfo</code> analyzes a descriptor, and reports a canonicalized version with checksum added.</li>
<li><code>deriveaddresses</code> takes as input a descriptor and computes the corresponding addresses.</li>
<li><code>listunspent</code> outputs a specialized descriptor for the reported unspent outputs.</li>
</ul>
<p>This document describes the language. For the specifics on usage, see the RPC documentation for the functions mentioned above.</p>
<h2>Features</h2>
<p>Output descriptors currently support:</p><ul>
<li>Pay-to-pubkey scripts (P2PK), through the <code>pk</code> function.</li>
<li>Pay-to-pubkey-hash scripts (P2PKH), through the <code>pkh</code> function.</li>
<li>Pay-to-witness-pubkey-hash scripts (P2WPKH), through the <code>wpkh</code> function.</li>
<li>Pay-to-script-hash scripts (P2SH), through the <code>sh</code> function.</li>
<li>Pay-to-witness-script-hash scripts (P2WSH), through the <code>wsh</code> function.</li>
<li>Multisig scripts, through the <code>multi</code> function.</li>
<li>Any type of supported address through the <code>addr</code> function.</li>
<li>Raw hex scripts through the <code>raw</code> function.</li>
<li>Public keys (compressed and uncompressed) in hex notation, or BIP32 extended pubkeys with derivation paths.</li>
</ul>
<h2>Examples</h2>
<ul>
<li><code>pk(0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798)</code> describes a P2PK output with the specified public key.</li>
<li><code>pkh(02c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5)</code> describes a P2PKH output with the specified public key.</li>
<li><code>wpkh(02f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9)</code> describes a P2WPKH output with the specified public key.</li>
<li><code>sh(wpkh(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556))</code> describes a P2SH-P2WPKH output with the specified public key.</li>
<li><code>combo(0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798)</code> describes any P2PK, P2PKH, P2WPKH, or P2SH-P2WPKH output with the specified public key.</li>
<li><code>sh(wsh(pkh(02e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd13)))</code> describes an (overly complicated) P2SH-P2WSH-P2PKH output with the specified public key.</li>
<li><code>multi(1,022f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4,025cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc)</code> describes a bare <em>1-of-2</em> multisig output with keys in the specified order.</li>
<li><code>sh(multi(2,022f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a01,03acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe))</code> describes a P2SH <em>2-of-2</em> multisig output with keys in the specified order.</li>
<li><code>wsh(multi(2,03a0434d9e47f3c86235477c7b1ae6ae5d3442d49b1943c2b752a68e2a47e247c7,03774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb,03d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85a))</code> describes a P2WSH <em>2-of-3</em> multisig output with keys in the specified order.</li>
<li><code>sh(wsh(multi(1,03f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8,03499fdf9e895e719cfd64e67f07d38e3226aa7b63678949e6e49b241a60e823e4,02d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e)))</code> describes a P2SH-P2WSH <em>1-of-3</em> multisig output with keys in the specified order.</li>
<li><code>pk(xpub661MyMwAqRbcFtXgS5sYJABqqG9YLmC4Q1Rdap9gSE8NqtwybGhePY2gZ29ESFjqJoCu1Rupje8YtGqsefD265TMg7usUDFdp6W1EGMcet8)</code> describes a P2PK output with the public key of the specified xpub.</li>
<li>&lsquo;pkh(xpub68Gmy5EdvgibQVfPdqkBBCHxA5htiqg55crXYuXoQRKfDBFA1WEjWgP6LHhwBZeNK1VTsfTFUHCdrfp1bgwQ9xv5ski8PX9rL2dZXvgGDnw/1&rsquo;/2)&lsquo; describes a P2PKH output with child key *1&rsquo;/2* of the specified xpub.</li>
<li>&lsquo;pkh([d34db33f/44&rsquo;/0'/0']xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL/1/*)<code>describes a set of P2PKH outputs, but additionally specifies that the specified xpub is a child of a master with fingerprint</code>d34db33f<code>, and derived using path</code>44'/0'/0'<code>. -</code>wsh(multi(1,xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/1/0/*,xpub69H7F5d8KSRgmmdJg2KhpAK8SR3DjMwAdkxj3ZuxV27CprR9LgpeyGmXUbC6wb7ERfvrnKZjXoUmmDznezpbZb7ap6r1D3tgFxHmwMkQTPH/0/0/*))<code>describes a set of *1-of-2* P2WSH multisig outputs where the first multisig key is the *1/0/</code>i<code>* child of the first specified xpub and the second multisig key is the *0/0/</code>i<code>* child of the second specified xpub, and</code>i<code>is any number in a configurable range (</code>0-1000` by default).</li>
</ul>
<h2>Reference</h2>
<p>Descriptors consist of several types of expressions. The top level expression is either a <code>SCRIPT</code>, or <code>SCRIPT::CHECKSUM</code> where <code>CHECKSUM</code> is an 8-character alphanumeric descriptor checksum.</p>
<p><code>SCRIPT</code> expressions:</p><ul>
<li><code>sh(SCRIPT)</code> (top level only): P2SH embed the argument.</li>
<li><code>wsh(SCRIPT)</code> (not inside another 'wsh'): P2WSH embed the argument.</li>
<li><code>pk(KEY)</code> (anywhere): P2PK output for the given public key.</li>
<li><code>pkh(KEY)</code> (anywhere): P2PKH output for the given public key (use <code>addr</code> if you only know the pubkey hash).</li>
<li><code>wpkh(KEY)</code> (not inside <code>wsh</code>): P2WPKH output for the given compressed pubkey.</li>
<li><code>combo(KEY)</code> (top level only): an alias for the collection of <code>pk(KEY)</code> and <code>pkh(KEY)</code>. If the key is compressed, it also includes <code>wpkh(KEY)</code> and <code>sh(wpkh(KEY))</code>.</li>
<li><code>multi(k,KEY_1,KEY_2,...,KEY_n)</code> (anywhere): k-of-n multisig script.</li>
<li><code>addr(ADDR)</code> (top level only): the script which ADDR expands to.</li>
<li><code>raw(HEX)</code> (top level only): the script whose hex encoding is HEX.</li>
</ul>
<p><code>KEY</code> expressions:</p><ul>
<li>Optionally, key origin information, consisting of:<ul>
<li>An open bracket <code>[</code></li>
<li>Exactly 8 hex characters for the fingerprint of the key where the derivation starts (see BIP32 for details)</li>
<li>Followed by zero or more <code>/NUM</code> or &lsquo;/NUM&rsquo;<code>path elements to indicate unhardened or hardened derivation steps between the fingerprint and the key or xpub/xprv root that follows</code></li>
<li><code>A closing bracket</code>]`</li>
</ul>
</li>
<li>Followed by the actual key, which is either:<ul>
<li>Hex encoded public keys (either 66 characters starting with <code>02</code> or <code>03</code> for a compressed pubkey, or 130 characters starting with <code>04</code> for an uncompressed pubkey).<ul>
<li>Inside <code>wpkh</code> and <code>wsh</code>, only compressed public keys are permitted.</li>
</ul>
</li>
<li><a href="https://en.bitcoin.it/wiki/Wallet_import_format">WIF</a> encoded private keys may be specified instead of the corresponding public key, with the same meaning.</li>
<li><code>xpub</code> encoded extended public key or <code>xprv</code> encoded extended private key (as defined in <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP 32</a>).<ul>
<li>Followed by zero or more <code>/NUM</code> unhardened and &lsquo;/NUM&rsquo;<code>hardened BIP32 derivation steps.</code></li>
<li><code>Optionally followed by a single</code>/*<code>or</code>/*'` final step to denote all (direct) unhardened or hardened children.</li>
<li>The usage of hardened derivation steps requires providing the private key.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>(Anywhere a &lsquo;&rsquo;<code>suffix is permitted to denote hardened derivation, the suffix</code>h` can be used instead.)</p>
<p><code>ADDR</code> expressions are any type of supported address:</p><ul>
<li>P2PKH addresses (<a class="el" href="../../de/dd7/namespacebase58.html">base58</a>, of the form <code>1...</code> for mainnet or <code>[nm]...</code> for testnet). Note that P2PKH addresses in descriptors cannot be used for P2PK outputs (use the <code>pk</code> function instead).</li>
<li>P2SH addresses (<a class="el" href="../../de/dd7/namespacebase58.html">base58</a>, of the form <code>3...</code> for mainnet or <code>2...</code> for testnet, defined in <a href="https://github.com/bitcoin/bips/blob/master/bip-0013.mediawiki">BIP 13</a>).</li>
<li>Segwit addresses (<a class="el" href="../../de/d63/namespacebech32.html">bech32</a>, of the form <code>bc1...</code> for mainnet or <code>tb1...</code> for testnet, defined in <a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">BIP 173</a>).</li>
</ul>
<h2>Explanation</h2>
<h3>Single-key scripts</h3>
<p>Many single-key constructions are used in practice, generally including P2PK, P2PKH, P2WPKH, and P2SH-P2WPKH. Many more combinations are imaginable, though they may not be optimal: P2SH-P2PK, P2SH-P2PKH, P2WSH-P2PK, P2WSH-P2PKH, P2SH-P2WSH-P2PK, P2SH-P2WSH-P2PKH.</p>
<p>To describe these, we model these as functions. The functions <code>pk</code> (P2PK), <code>pkh</code> (P2PKH) and <code>wpkh</code> (P2WPKH) take as input a <code>KEY</code> expression, and return the corresponding <em>scriptPubKey</em>. The functions <code>sh</code> (P2SH) and <code>wsh</code> (P2WSH) take as input a <code>SCRIPT</code> expression, and return the script describing P2SH and P2WSH outputs with the input as embedded script. The names of the functions do not contain "p2" for brevity.</p>
<h3>Multisig</h3>
<p>Several pieces of software use multi-signature (multisig) scripts based on Bitcoin's OP_CHECKMULTISIG opcode. To support these, we introduce the <code>multi(k,key_1,key_2,...,key_n)</code> function. It represents a <em>k-of-n</em> multisig policy, where any <em>k</em> out of the <em>n</em> provided <code>KEY</code> expressions must sign.</p>
<p>Key order is significant. A <code>multi()</code> expression describes a multisig script with keys in the specified order, and in a search for TXOs, it will not match outputs with multisig scriptPubKeys that have the same keys in a different order. Also, to prevent a combinatorial explosion of the search space, if more than one of the <code>multi()</code> key arguments is a BIP32 wildcard path ending in <code>/*</code> or &lsquo;*&rsquo;<code>, the</code>multi()<code>expression only matches multisig scripts with the</code>i`th child key from each wildcard path in lockstep, rather than scripts with any combination of child keys from each wildcard path.</p>
<h3>BIP32 derived keys and chains</h3>
<p>Most modern wallet software and hardware uses keys that are derived using BIP32 ("HD keys"). We support these directly by permitting strings consisting of an extended public key (commonly referred to as an <em>xpub</em>) plus derivation path anywhere a public key is expected. The derivation path consists of a sequence of 0 or more integers (in the range <em>0..2<sup>31</sup>-1</em>) each optionally followed by &lsquo;&rsquo;<code>or</code>h<code>, and separated by</code>/<code>characters. The string may optionally end with the literal</code>/*<code>or</code>/*'<code>(or</code>/*h<code>) to refer to all unhardened or hardened child keys in a configurable range (by default</code>0-1000`, inclusive).</p>
<p>Whenever a public key is described using a hardened derivation step, the script cannot be computed without access to the corresponding private key.</p>
<h3>Key origin identification</h3>
<p>In order to describe scripts whose signing keys reside on another device, it may be necessary to identify the master key and derivation path an xpub was derived with.</p>
<p>For example, when following BIP44, it would be useful to describe a change chain directly as &lsquo;xpub.../44&rsquo;/0'/0'/1/*<code>where</code>xpub...<code> corresponds with the master key</code>m`. Unfortunately, since there are hardened derivation steps that follow the xpub, this descriptor does not let you compute scripts without access to the corresponding private keys. Instead, it should be written as <code>xpub.../1/*</code>, where xpub corresponds to &lsquo;m/44&rsquo;/0'/0'`.</p>
<p>When interacting with a hardware device, it may be necessary to include the entire path from the master down. <a href="https://github.com/bitcoin/bips/blob/master/bip-0174.mediawiki">BIP174</a> standardizes this by providing the master key <em>fingerprint</em> (first 32 bit of the Hash160 of the master pubkey), plus all derivation steps. To support constructing these, we permit providing this key origin information inside the descriptor language, even though it does not affect the actual scriptPubKeys it refers to.</p>
<p>Every public key can be prefixed by an 8-character hexadecimal fingerprint plus optional derivation steps (hardened and unhardened) surrounded by brackets, identifying the master and derivation path the key or xpub that follows was derived with.</p>
<p>Note that the fingerprint of the parent only serves as a fast way to detect parent and child nodes in software, and software must be willing to deal with collisions.</p>
<h3>Including private keys</h3>
<p>Often it is useful to communicate a description of scripts along with the necessary private keys. For this reason, anywhere a public key or xpub is supported, a private key in WIF format or xprv may be provided instead. This is useful when private keys are necessary for hardened derivation steps, or for dumping wallet descriptors including private key material.</p>
<h3>Compatibility with old wallets</h3>
<p>In order to easily represent the sets of scripts currently supported by existing Bitcoin Core wallets, a convenience function <code>combo</code> is provided, which takes as input a public key, and describes a set of P2PK, P2PKH, P2WPKH, and P2SH-P2WPH scripts for that key. In case the key is uncompressed, the set only includes P2PK and P2PKH scripts.</p>
<h3>Checksums</h3>
<p>Descriptors can optionally be suffixed with a checksum to protect against typos or copy-paste errors.</p>
<p>These checksums consist of 8 alphanumeric characters. As long as errors are restricted to substituting characters in &lsquo;0123456789()[],&rsquo;/*abcdefgh@:$%{}` for others in that set and changes in letter case, up to 4 errors will always be detected in descriptors up to 501 characters, and up to 3 errors in longer ones. For larger numbers of errors, or other types of errors, there is a roughly 1 in a trillion chance of not detecting the errors.</p>
<p>All RPCs in Bitcoin Core will include the checksum in their output. Only certain RPCs require checksums on input, including <code>deriveaddress</code> and <code>importmulti</code>. The checksum for a descriptor without one can be computed using the <code>getdescriptorinfo</code> RPC. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
